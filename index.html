<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mecathon</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        .hide {
            display: none;
        }
        .car {
            width: 50px;
            height: 70px;
            background-position: center;
            position: absolute;
            bottom: 120px;
            background-size: cover;
        }
        .GameArea {
            width: 90%;
            max-width: 400px;
            height: 100vh;
            background-color: rgb(29, 26, 26);
            margin: auto;
            position: relative;
            overflow: hidden;
            border-left: 10px dashed white;
            border-right: 10px dashed white;
        }
        .lines {
            width: 10px;
            height: 100px;
            background: white;
            position: absolute;
            margin-left: 50%;
            transform: translateX(-50%);
        }
        .CarGame {
            background-image: url(./img/grass.jpg);
            background-size: cover;
        }
        .other {
            width: 50px;
            height: 70px;
            background-color: blue;
            position: absolute;
            bottom: 120px;
        }
        .Score {
            position: absolute;
            top: 15px;
            text-align: center;
            padding-top: 23px;
            font-size: 15px;
            background-color: black;
            color: white;
            padding: 10px 12px;
        }
        .StartScreen {
            position: absolute;
            background-color: orange;
            color: white;
            z-index: 1;
            margin-top: 210px;
            margin-left: 25%;
            margin-right: 25%;
            text-align: center;
            box-shadow: 0 0 20px 0px rgba(0, 0, 0, 0.1);
            font-size: 20px;
            width: 50%;
            height: auto;
            cursor: pointer;
            border-radius: 20px;
            padding: 10px 12px;
        }
        .StartScreen button {
            padding: 10px;
            text-align: center;
            background-color: black;
            color: white;
            border: none;
            border-radius: 20px;
        }
        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }
        .control-btn {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.5);
            text-align: center;
            line-height: 50px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        .none {
            display: none;
        }
        #race {
            width: 100%;
            height: 100vh;
            background-image: url(img/speed.jpg);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .race-title {
            color: cornsilk;
            padding-top: 295px;
            font-family: cursive;
            font-weight: bolder;
            animation-name: race;
            animation-duration: 2s;
            animation-direction: alternate;
            animation-iteration-count: infinite;
        }
        @keyframes race {
            0% {
                font-size: 30px;
            }
            100% {
                font-size: 40px;
            }
        }
        .gamemenu {
            width: 100%;
            height: 100vh;
            background-image: url(img/fire.jpeg);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .menu {
            position: fixed;
            bottom: 5px;
            background: transparent;
            width: 40%;
            padding: 10px 12px;
            left: 0;
            color: white;
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
        }
        .menua {
            padding: 10px 12px;
            background-color: transparent;
            transform: skew(10deg, 0deg);
            border: 1px solid orangered;
        }
        .menua:hover {
            background-color: orangered;
            transition: 0.3s;
        }
        .gamemenu button {
            position: fixed;
            bottom: 5px;
            right: 5px;
            transform: skew(10deg);
            padding: 10px 30px;
            background: orange;
            font-size: 20px;
            font-family: cursive;
            border: none;
            cursor: pointer;
        }
        .points1 {
            background-color: orange;
            color: white;
            padding: 10px 12px;
            transform: skew(-10deg, 0deg);
        }
        .points2 {
            background-color: red;
            color: white;
            padding: 10px 12px;
            transform: skew(-10deg, 0deg);
        }
        .point {
            position: fixed;
            width: auto;
            padding: 10px 12px;
            top: 10px;
            left: 0;
            display: flex;
            flex-direction: row;
        }
        .share {
            background-color: lightgreen;
            color: white;
            padding: 10px 20px;
            position: fixed;
            right: 10px;
            top: 5px;
            transform: skew(10deg, 0deg);
        }
        .choose-car {
            width: 100%;
            height: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            overflow-x: scroll;
            overflow-y: hidden;
            scrollbar-width: thin;
        }
        .car-image {
            width: 400px;
            padding: 5px;
            height: 250px;
            transform: skew(-10deg, 0deg);
        }
        /* Media Query for smaller screens */
        @media (max-width: 768px) {
            .car-image {
                width: 200px;
                height: 125px;
            }
            .menu {
                width: 60%;
            }
        }
    </style>
</head>
<body onload="Racing()">
    <div id="race">
        <center>
            <h1 class="race-title"><span style="color: orange; font-size: 50px; font-weight: bolder; font-family: cursive;">MEC</span>athon</h1>
        </center>
    </div>

    <div id="gamemenu" class="gamemenu none">
        <div class="point">
            <div class="points1"></div>
            <div class="points2">Points ++</div>
        </div>

        <center>
            <input type="text" id="chosen-car" style="padding: 10px 12px; border: none;" readonly>
            <input type="hidden" id="speed-car" readonly>
        </center>

        <div style="padding-top: 180px;">
            <p style="color: white; font-size: 30px; font-family: cursive; text-align: center;">Select a car</p>
            <div class="choose-car">
                <img class="car-image" onclick="selectCar('Jeep', 10)" src="./img/jeep.jpg" />
                <img class="car-image" onclick="selectCar('Mercedes Benz', 8)" src="./img/mercedes-benz.jpg"/>
                <img class="car-image" onclick="selectCar('Lamborghini', 16)" src="./img/lamborghini.jpg"/>
                <img class="car-image" onclick="selectCar('Bugatti', 13)" src="./img/bugatti.png"/>
                <img class="car-image" onclick="selectCar('F1', 18)" src="./img/driver.jpg"/>
            </div>
        </div>

        <div class="share">share</div>

        <div class="menu">
            <div class="menua"><a>Home</a></div>
            <div class="menua"><a>Help</a></div>
            <div class="menua"><a>Online Race</a></div>
        </div>

        <button onclick="CheckStart()">Start</button>
    </div>

    <div class="CarGame none" id="gamemode">
        <div class="Score"></div>
        <center>
            <div class="StartScreen">
                <p>Start Game by clicking Here<br><br>Arrow Keys or Touch to move<br><br>If you hit another car you will lose</p>
                <button onclick="start()">Start Game</button>
                <button onclick="Reset()">Reset Highest Score</button>
            </div>
        </center>
        <div class="GameArea"></div>
        <div<div class="controls">
            <div class="control-btn" onclick="moveLeft()">⬅️</div>
            <div class="control-btn" onclick="moveRight()">➡️</div>
        </div>
    </div>

    <script>
        let player = { speed: 5, score: 0, carSelected: false };
        const gameArea = document.querySelector('.GameArea');
        const gameMode = document.getElementById('gamemode');
        const gameMenu = document.getElementById('gamemenu');
        const chosenCar = document.getElementById('chosen-car');
        const speedCar = document.getElementById('speed-car');
        let keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };

        document.addEventListener('keydown', pressOn);
        document.addEventListener('keyup', pressOff);

        function Racing() {
            gameMenu.classList.remove('none');
        }

        function selectCar(car, speed) {
            chosenCar.value = car;
            speedCar.value = speed;
            player.carSelected = true;
        }

        function CheckStart() {
            if (player.carSelected) {
                gameMenu.classList.add('none');
                gameMode.classList.remove('none');
            } else {
                alert('Please select a car first!');
            }
        }

        function start() {
            const startScreen = document.querySelector('.StartScreen');
            startScreen.classList.add('hide');
            player.start = true;
            player.score = 0;
            gameArea.innerHTML = '';

            const car = document.createElement('div');
            car.setAttribute('class', 'car');
            car.style.backgroundImage = `url('./img/${chosenCar.value.toLowerCase().replace(' ', '-')}.jpg')`;
            gameArea.appendChild(car);

            player.x = car.offsetLeft;
            player.y = car.offsetTop;

            window.requestAnimationFrame(playGame);
        }

        function playGame() {
            let car = document.querySelector('.car');
            let road = gameArea.getBoundingClientRect();

            if (player.start) {
                moveLines();
                moveEnemy(car);
                if (keys.ArrowUp && player.y > road.top) { player.y -= player.speed; }
                if (keys.ArrowDown && player.y < (road.bottom - car.offsetHeight)) { player.y += player.speed; }
                if (keys.ArrowLeft && player.x > 0) { player.x -= player.speed; }
                if (keys.ArrowRight && player.x < (road.width - car.offsetWidth)) { player.x += player.speed; }

                car.style.top = player.y + 'px';
                car.style.left = player.x + 'px';

                window.requestAnimationFrame(playGame);
                player.score++;
                document.querySelector('.Score').innerText = "Score: " + player.score;
            }
        }

        function pressOn(e) {
            e.preventDefault();
            keys[e.key] = true;
        }

        function pressOff(e) {
            e.preventDefault();
            keys[e.key] = false;
        }

        function moveLines() {
            let lines = document.querySelectorAll('.lines');
            lines.forEach(function (item) {
                if (item.y >= 700) {
                    item.y -= 750;
                }
                item.y += player.speed;
                item.style.top = item.y + 'px';
            });
        }

        function moveEnemy(car) {
            let enemies = document.querySelectorAll('.other');
            enemies.forEach(function (item) {
                if (isCollide(car, item)) {
                    endGame();
                }
                if (item.y >= 700) {
                    item.y = -300;
                    item.style.left = Math.floor(Math.random() * 350) + 'px';
                }
                item.y += player.speed;
                item.style.top = item.y + 'px';
            });
        }

        function isCollide(a, b) {
            let aRect = a.getBoundingClientRect();
            let bRect = b.getBoundingClientRect();

            return !(
                (aRect.bottom < bRect.top) ||
                (aRect.top > bRect.bottom) ||
                (aRect.right < bRect.left) ||
                (aRect.left > bRect.right)
            );
        }

        function endGame() {
            player.start = false;
            const startScreen = document.querySelector('.StartScreen');
            startScreen.classList.remove('hide');
            startScreen.innerHTML = 'Game Over<br>Score was ' + player.score + '<br>Click here to restart the game';
        }

        function Reset() {
            localStorage.removeItem('highscore');
            alert('Highest score reset!');
        }

        function moveLeft() {
            keys.ArrowLeft = true;
            setTimeout(() => keys.ArrowLeft = false, 100);
        }

        function moveRight() {
            keys.ArrowRight = true;
            setTimeout(() => keys.ArrowRight = false, 100);
        }
    </script>
</body>
</html>
